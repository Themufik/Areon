{% extends 'main/base.html' %}

{% block title %}{{ lesson.title }}{% endblock %}

{% block extra_css %}
<style>
    .breadcrumb {
        margin-bottom: 2rem;
        color: #666;
    }

    .breadcrumb a {
        color: #3498db;
        text-decoration: none;
    }

    .lesson-header {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .lesson-header h1 {
        margin-bottom: 1rem;
    }

    .lesson-meta {
        display: flex;
        gap: 2rem;
        color: #666;
        margin-bottom: 1rem;
    }

    .lesson-description {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 5px;
        margin-top: 1rem;
        font-style: italic;
        color: #666;
    }

    .lesson-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .lesson-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .lesson-content h2 {
        margin-bottom: 1rem;
        color: #2c3e50;
    }

    .lesson-text {
        line-height: 1.8;
        font-size: 1.05rem;
        white-space: pre-line;
    }

    .lesson-file {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 5px;
        margin-top: 2rem;
    }

    .lesson-file a {
        color: #3498db;
        text-decoration: none;
        font-size: 1.1rem;
    }

    .navigation {
        display: flex;
        justify-content: space-between;
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .complete-section {
        text-align: center;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .completed-badge {
        display: inline-block;
        background: #27ae60;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'index' %}">–ì–ª–∞–≤–Ω–∞—è</a> /
    <a href="{% url 'course_list' %}">–ö—É—Ä—Å—ã</a> /
    <a href="{% url 'course_detail' course.id %}">{{ course.name }}</a> /
    {{ lesson.title }}
</div>

<div class="lesson-header">
    <h1>{{ lesson.order }}. {{ lesson.title }}</h1>

    <div class="lesson-description">
        üìù {{ lesson.description }}
    </div>

    <div class="lesson-meta">
        <span>üìö {{ course.name }}</span>
        <span>üìÖ {{ lesson.created_at|date:"d.m.Y" }}</span>
        {% if is_completed %}
            <span class="completed-badge">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω</span>
        {% endif %}
    </div>

    {% if user == course.author %}
    <div class="lesson-actions">
        <a href="{% url 'lesson_edit' lesson.id %}" class="btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'lesson_delete' lesson.id %}" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    </div>
    {% endif %}
</div>

<div class="lesson-content">
    <h2>üìñ –ú–∞—Ç–µ—Ä–∏–∞–ª —É—Ä–æ–∫–∞</h2>
    <div class="lesson-text">{{ lesson.content }}</div>

    {% if lesson.file %}
    <div class="lesson-file">
        <strong>üìé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</strong><br>
        <a href="{{ lesson.file.url }}" target="_blank" download>
            üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª ({{ lesson.file.name }})
        </a>
    </div>
    {% endif %}
</div>

{% if user.is_authenticated %}
<div class="complete-section">
    <h3>{% if is_completed %}üéâ –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç—Ç–æ—Ç —É—Ä–æ–∫!{% else %}–ó–∞–≤–µ—Ä—à–∏—Ç–µ —É—Ä–æ–∫{% endif %}</h3>
    <form method="POST" action="{% url 'lesson_complete' lesson.id %}" style="margin-top: 1rem;">
        {% csrf_token %}
        <button type="submit" class="btn {% if is_completed %}btn-danger{% else %}btn-success{% endif %}">
            {% if is_completed %}
                ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            {% else %}
                ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π
            {% endif %}
        </button>
    </form>
</div>
{% endif %}

<div class="navigation">
    <div class="nav-button">
        {% if prev_lesson %}
            <a href="{% url 'lesson_detail' prev_lesson.id %}" class="btn">
                ‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫
            </a>
        {% else %}
            <span style="color: #ccc;">‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫</span>
        {% endif %}
    </div>

    <a href="{% url 'course_detail' course.id %}" class="btn">
        üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å—É
    </a>

    <div class="nav-button">
        {% if next_lesson %}
            <a href="{% url 'lesson_detail' next_lesson.id %}" class="btn btn-success">
                –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚û°Ô∏è
            </a>
        {% else %}
            <span style="color: #ccc;">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚û°Ô∏è</span>
        {% endif %}
    </div>
</div>
{% endblock %}